!function(){var e,n,t;!function(r){function o(e,n){return v.call(e,n)}function i(e,n){var t,r,o,i,u,c,s,a,f,l,h,p=n&&n.split("/"),m=w.map,d=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(n){for(e=e.split("/"),u=e.length-1,w.nodeIdCompat&&k.test(e[u])&&(e[u]=e[u].replace(k,"")),e=p.slice(0,p.length-1).concat(e),f=0;f<e.length;f+=1)if(h=e[f],"."===h)e.splice(f,1),f-=1;else if(".."===h){if(1===f&&(".."===e[2]||".."===e[0]))break;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||d)&&m){for(t=e.split("/"),f=t.length;f>0;f-=1){if(r=t.slice(0,f).join("/"),p)for(l=p.length;l>0;l-=1)if(o=m[p.slice(0,l).join("/")],o&&(o=o[r])){i=o,c=f;break}if(i)break;!s&&d&&d[r]&&(s=d[r],a=f)}!i&&s&&(i=s,c=a),i&&(t.splice(0,c,i),e=t.join("/"))}return e}function u(e,n){return function(){var t=E.call(arguments,0);return"string"!=typeof t[0]&&1===t.length&&t.push(null),p.apply(r,t.concat([e,n]))}}function c(e){return function(n){return i(n,e)}}function s(e){return function(n){g[e]=n}}function a(e){if(o(y,e)){var n=y[e];delete y[e],b[e]=!0,h.apply(r,n)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function f(e){var n,t=e?e.indexOf("!"):-1;return t>-1&&(n=e.substring(0,t),e=e.substring(t+1,e.length)),[n,e]}function l(e){return function(){return w&&w.config&&w.config[e]||{}}}var h,p,m,d,g={},y={},w={},b={},v=Object.prototype.hasOwnProperty,E=[].slice,k=/\.js$/;m=function(e,n){var t,r=f(e),o=r[0];return e=r[1],o&&(o=i(o,n),t=a(o)),o?e=t&&t.normalize?t.normalize(e,c(n)):i(e,n):(e=i(e,n),r=f(e),o=r[0],e=r[1],o&&(t=a(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:t}},d={require:function(e){return u(e)},exports:function(e){var n=g[e];return"undefined"!=typeof n?n:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:l(e)}}},h=function(e,n,t,i){var c,f,l,h,p,w,v=[],E=typeof t;if(i=i||e,"undefined"===E||"function"===E){for(n=!n.length&&t.length?["require","exports","module"]:n,p=0;p<n.length;p+=1)if(h=m(n[p],i),f=h.f,"require"===f)v[p]=d.require(e);else if("exports"===f)v[p]=d.exports(e),w=!0;else if("module"===f)c=v[p]=d.module(e);else if(o(g,f)||o(y,f)||o(b,f))v[p]=a(f);else{if(!h.p)throw new Error(e+" missing "+f);h.p.load(h.n,u(i,!0),s(f),{}),v[p]=g[f]}l=t?t.apply(g[e],v):void 0,e&&(c&&c.exports!==r&&c.exports!==g[e]?g[e]=c.exports:l===r&&w||(g[e]=l))}else e&&(g[e]=t)},e=n=p=function(e,n,t,o,i){if("string"==typeof e)return d[e]?d[e](n):a(m(e,n).f);if(!e.splice){if(w=e,w.deps&&p(w.deps,w.callback),!n)return;n.splice?(e=n,n=t,t=null):e=r}return n=n||function(){},"function"==typeof t&&(t=o,o=i),o?h(r,e,n,t):setTimeout(function(){h(r,e,n,t)},4),p},p.config=function(e){return p(e)},e._defined=g,t=function(e,n,t){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(t=n,n=[]),o(g,e)||o(y,e)||(y[e]=[e,n,t])},t.amd={jQuery:!0}}(),t("vendor/almond",function(){}),t("common/utils",[],function(){function e(){}return e.getCookie=function(e){return new Promise(function(n,t){window.hasOwnProperty("chrome")&&chrome.hasOwnProperty("cookies")?chrome.cookies.get({name:e,url:"https://www.bungie.net"},function(e){e?n(e.value):t()}.bind(this)):t()}.bind(this))},e.logError=function(e){if(e instanceof Error)throw e;console.error("Error["+e.ErrorCode+'] -> "'+e.Message+'"')},e}),t("common/api",["common/utils"],function(e){function n(){}return n.key=null,n.base="https://www.bungie.net/Platform",n.requestWithToken=function(){var t=this,r=[].slice.call(arguments);return new Promise(function(o,i){e.getCookie("bungled").then(function(e){var u=function(){delete t._csrf};t._csrf=e,n.request.apply(t,r).then(o)["catch"](i).then(u)})})},n.request=function(e,t,r,o){var i=this;return new Promise(function(u,c){var s=new XMLHttpRequest;s.onload=function(){var e=this.response,n=JSON.parse(e);this.status>=200&&this.status<400?n.ErrorCode>1?c(n):u(n.Response):c(n)},s.onerror=function(){var e=this.response,n=JSON.parse(e);c(n)};var a=[n.base.replace(/(\/$)/,""),t.replace(/(^\/|\/$)/,"")].join("/")+"/"+n.objectToQueryString(r||{});s.open(e,a,!0),i._csrf&&(s.withCredentials=!0,s.setRequestHeader("X-CSRF",i._csrf)),s.setRequestHeader("X-API-Key",n.key),s.send(o)})},n.objectToQueryString=function(e){var n=[];for(var t in e)n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n?"?"+n.join("&"):""},n}),t("models/character",[],function(){function e(){}return e}),t("models/account",["models/character","common/api"],function(e,n){function t(n){this.id=n.userInfo.membershipId,this.type=n.userInfo.membershipType,this.lastPlayed=n.lastPlayed,this.grimoire=n.grimoireScore,this.avatar="https://www.bungie.net/"+n.userInfo.iconPath.replace(/^\//,""),this.characters=n.characters.map(function(n){return new e(n)})}return t.prototype.isXBL=function(){return 1===this.type},t.prototype.isPSN=function(){return 2===this.type},t.prototype.getVault=function(){var e=this;return new Promise(function(t,r){n.requestWithToken("GET","/Destiny/"+e.type+"/MyAccount/Vault",{definitions:!0}).then(t)["catch"](r)})},t}),t("common/bungie",["common/utils","common/api","models/account"],function(e,n,t){function r(e,t){e&&(n.key=e),t&&(n.base=t),this._accounts=[],this._authed=!1}return r.prototype.authorize=function(){var e=this;return new Promise(function(r,o){n.requestWithToken("GET","/User/GetBungieNetUser").then(function(i){var u=-1;if(i.hasOwnProperty("gamerTag"))u=1;else{if(!i.hasOwnProperty("psnId"))throw new Error("Unknown user type.");u=2}n.requestWithToken("GET","/User/GetBungieAccount/"+i.user.membershipId+"/0").then(function(n){e._authed=!0;for(var o in n.destinyAccounts)e._accounts.push(new t(n.destinyAccounts[o]));r()})["catch"](o)})})},r.prototype.getAccounts=function(){if(!this._authed)throw new Error("Not authenticated.");return this._accounts},new r}),t("DestinyCTRL",["common/bungie"],function(e){function n(){}return n.initialize=function(){e.authorize().then(function(){var n=e.getAccounts();n[0].getVault().then(function(e){console.log(e)})})},n}),n(["common/utils","DestinyCTRL"],function(e,n){if(!window.hasOwnProperty("chrome"))throw new Error("Browser not supported");chrome.browserAction.onClicked.addListener(function(){var n=chrome.extension.getURL("index.html"),t=function(t){try{t.length?chrome.tabs.update(t[0].id,{active:!0}):chrome.tabs.create({url:n})}catch(r){e.handleError(r)}};try{chrome.tabs.query({url:n},t)}catch(r){e.handleError(r)}}),n.initialize()}),t("main",function(){})}();
//# sourceMappingURL=main.js
//# sourceMappingURL=main.js.map